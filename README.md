# Rally

Service Re-Engagement Email Agent for Automotive Dealerships

## Demo

**Live Demo:** [Link here](https://www.loom.com/share/2dc3d24e3d564f4b8c774faa2f0ae28d?sid=f3742157-8bda-46e4-9a71-9c3297d78099)

## Overview

Rally is an automated re-engagement system for car dealerships. The idea: automatically email customers when their vehicle is due for service (based on service history and cadence rules), and keep conversations organized in one place.

### What I built:

- **Rule-based targeting** - Create rules like "email customers every 6 months after their last oil change"
- **Cohort preview** - See who's eligible before you send
- **Campaign scheduling** - Send now or schedule for later (with recurring schedules support)
- **Email simulation** - Simulates the full email lifecycle (queued → sent → delivered) with realistic delays
- **AI-powered replies** - Customers "respond" to emails using OpenAI.
- **Conversation threads** - All emails grouped by campaign, with reply tracking
- **Customer/Vehicle management** - Track service history, appointments, and vehicle info
- **Import tool** - CSV upload for bulk customer data

## Key Features

**Rules & Campaigns**
- Create targeting rules (e.g., "email customers 6 months after last oil change")
- Preview eligible cohorts before sending
- Send immediately or schedule for later
- Recurring schedules (daily/weekly/monthly)

**Customer Management**
- Track customers, vehicles, and service history
- VIN and license plate lookup
- Appointment scheduling
- CSV import for bulk data

**Email System**
- Simulated email lifecycle (queued → sent → delivered)
- Threaded conversations (grouped by campaign)
- Status tracking and delivery monitoring
- Background worker processing

**AI Simulation** (optional)
- Customer replies generated by OpenAI
- Different personality types (eager, hesitant, price-conscious)
- Falls back to preset responses if API key not provided

## Tech Stack

- **Framework:** Next.js 16 with React 19
- **Database:** PostgreSQL with Prisma ORM
- **Styling:** Tailwind CSS
- **UI Components:** Radix UI
- **AI:** OpenAI GPT-4o-mini (optional)
- **Forms:** React Hook Form with Zod validation
- **Icons:** Lucide React

## How to Run

**You'll need:**
- Node.js 20+
- PostgreSQL
- pnpm

**Quick start:**

```bash
# 1. Clone and install
git clone <repository-url>
cd rally
pnpm install

# 2. Set up environment variables
cp .env.example .env  # (or create .env manually)
# Add your DATABASE_URL

# 3. Database setup
pnpm db:migrate  # Run migrations

# 4. Start it up
pnpm dev
```

Open [http://localhost:3000](http://localhost:3000) and you're good to go.

### Environment Variables

Create a `.env` file:

```env
DATABASE_URL="postgresql://user:password@localhost:5432/rally"
NODE_ENV="development"

# Optional: For AI-powered customer replies
OPENAI_API_KEY="sk-your-api-key-here"
```

## Open IA

The app can simulate customer replies using OpenAI. 

To enable:
1. Get an API key from [OpenAI](https://platform.openai.com/api-keys)
2. Add `OPENAI_API_KEY="sk-..."` to your `.env`
3. That's it


## Project Structure

```
rally/
├── prisma/
│   ├── migrations/        # Database migrations
│   ├── schema.prisma      # Database schema
│   └── seed.ts           # Seed data
├── src/
│   ├── app/
│   │   ├── _actions/     # Server actions
│   │   ├── _components/  # React components
│   │   ├── campaigns/    # Campaign pages
│   │   ├── conversations/# Conversation pages
│   │   └── rules/        # Rule management pages
│   ├── components/ui/    # Reusable UI components
│   ├── constants/        # App constants
│   ├── lib/             # Utility functions
│   ├── schemas/         # Zod validation schemas
│   └── server/
│       ├── db.ts        # Database client
│       ├── env.ts       # Environment validation
│       ├── services/    # Business logic
│       └── workers/     # Background jobs
└── public/              # Static assets
```

## How to Use

**1. Create a rule** (Rules page)
- Define what service type (oil change, tire rotation, etc.)
- Set cadence (every 3, 6, 12 months)
- Write email template with placeholders like `{{customerName}}`
- Preview who's eligible before saving

**2. Send a campaign** (Rules → Send Campaign)
- See the cohort preview
- Send now or schedule for later
- Watch it run on the Campaigns page

**3. Check conversations** (Campaigns → Click a campaign)
- See all the emails sent
- Click into any conversation to see the thread
- Use "Simulate Reply" to generate customer responses (AI or preset)

**4. Import data** (Customers → Import)
- Upload CSV with customer/vehicle data
- See the sample file for format

## Database Schema

Key models:

- **Customer** - Customer information and contact details
- **Vehicle** - Vehicle details linked to customers
- **ServiceHistory** - Past service records
- **Rule** - Campaign rules and templates
- **RuleRun** - Campaign execution instances
- **Email** - Email messages with threading support
- **ScheduledCampaign** - Future campaign scheduling
- **Appointment** - Booked service appointments

See [prisma/schema.prisma](./prisma/schema.prisma) for full schema.

### Thinking Notes
I took notes on the decisions I took while building this so If you want to see more deeply how do I think you should check it out.

[Thinking Notes](./thinking-notes.md) - Architecture decisions and trade-offs
